---
export const prerender = false;
import { getCollection } from "astro:content";
import type { GetStaticPaths, Page } from "astro";
import { siteName } from "~/data/config";
import Layout from "~/layouts/Layout.astro";
import Section from "~/components/Section.astro";
import Container from "~/components/Container.astro";
import Heading from "~/components/Heading.astro";
import CardCar from "~/components/car/CardCar.astro";
import SidebarFiltersDesktop from "~/components/sidebars/SidebarFiltersDesktop.astro";
import SidebarFiltersMobile from "~/components/sidebars/SidebarFiltersMobile.astro";
import Pagination from "~/components/Pagination.astro";


interface Car {
	data: {
		general: {
			make: string;
		};
		exterior: {
			color: string;
		};
	};
}


export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
	const apiUrl = new URL("/api/getFilteredCars.json", Astro.url);
	const cars: Car[] = await fetch(apiUrl).then((res) => res.json());

	return paginate(cars, {
		pageSize: 12,
		params: { page: undefined },
	});
};

interface Props {
	page: Page<any>;
}

const { page } = Astro.props;
---

<Layout pageTitle={`Cars | ${siteName}`} description="Explore our range of cars for sale.">
	<Section class:list={"bg-gray-50"}>
		<Container class:list={"max-lg:px-0 max-lg:max-w-full"}>
			<div class="flex flex-col lg:flex-row">
				<SidebarFiltersMobile />

				<div class="lg:hidden bg-yellow-200 flex items-center justify-center p-2 mb-8">
					<button id="button-modal-filter-open" type="button" class="-m-2.5 p-2.5 lg:hidden">
						<span class="sr-only">Open filter</span>
						<div class="flex items-center space-x-2">
							<svg
								class="size-5"
								fill="none"
								viewBox="0 0 24 24"
								stroke-width="1.5"
								stroke="currentColor"
								aria-hidden="true"
								data-slot="icon"
							>
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
							</svg>
							<span>Filter: found 12 cars</span>
						</div>
					</button>
				</div>

				<SidebarFiltersDesktop />

				<main class="lg:pl-16 grow">
					<div class="lg:px-8">
						<ul class="grid grid-cols-1 lg:gap-16">
							{page.data.map((car) => <CardCar car={car} />)}
						</ul>

						<Pagination page={page} />
					</div>
				</main>
			</div>
		</Container>
	</Section>
</Layout>

<script>
	document.addEventListener("astro:page-load", function () {
		const buttonModalFilterOpen = document.getElementById("button-modal-filter-open");
		const buttonModalFilterClose = document.getElementById("button-modal-filter-close");
		const sidebarFiltersMobile = document.getElementById("modal-filter") as HTMLDialogElement;

		if (sidebarFiltersMobile) {
			buttonModalFilterOpen?.addEventListener("click", () => {
				sidebarFiltersMobile.open = true;
			});

			buttonModalFilterClose?.addEventListener("click", () => {
				console.log("close");
				sidebarFiltersMobile.open = false;
			});
		}
	});
</script>
